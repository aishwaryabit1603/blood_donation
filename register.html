<?php
    //start a session output buffering
    ob_start();
    session_start();

    //must require db connection file
    require "db_connection.php";

    //checking if all post fields are SET
    if(isset($_POST['name']) && isset($_POST['sex']) && isset($_POST['dob']) &&isset($_POST['bloodgroup']) &&isset($_POST['mobile_no']) &&isset($_POST['email']) &&isset($_POST['state']) && isset($_POST['district']) && isset($_POST['user_name']) &&isset($_POST['password']))
    {
        if (!empty($_POST['name']) && !empty($_POST['sex']) && !empty($_POST['dob']) && !empty($_POST['bloodgroup']) && !empty($_POST['mobile_no']) && !empty($_POST['email']) && !empty($_POST['state']) && !empty($_POST['district']) && !empty($_POST['user_name']) && !empty($_POST['password'])) 
        {
            // Store POST variables in local variables
            $user = $_POST['user_name'];
            $pw = md5($_POST['password']);
            $f_name = $_POST['name'];
            $birthday = $_POST['dob'];
            $sex = $_POST['sex'];
            $blood = $_POST['bloodgroup'];
            $mobile = $_POST['mobile_no'];
            $email = $_POST['email'];
            $state = $_POST['state'];
            $district = $_POST['district']
        }
    }

    //checking if session is active or NOT
    if (isset($_SESSION['sess_user_id']) && !empty($_SESSION['sess_user_id'])) 
    {
        // If a session is active
        $sess = $_SESSION['sess_user_id'];
        $SQL = "UPDATE donors SET user_name='" .$user . "',password='" . $pw . "',name='" . $f_name . "',dob='" . $birthday . "',sex='" . $sex . "',bloodgroup='" . $blood . "',mobile_no='" . $mobile . "',email='" . $email . "',state='" . $state . "',district='" . $district . "' WHERE id='" . $sess . "'";
    } 
    else 
    {
        $SQL = "INSERT INTO donors ("user_name", "password", "name", dob, "sex", "bloodgroup", mobile_no, "email","state","district") VALUES ('" . $user . "', '" . $pw . "', '" . $f_name . "', '" . $birthday . "', '" . $sex . "', '" . $blood . "', '" . $mobile . "', '" . $email . "', '" . $state . "', '" . $district . "')";
    }

    
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REGISTRATION FORM</title>
    <LINK REL = "stylesheet" href = "css/register_form.css">
    <script type="text/javascript" src="statesdropdown.js.js"></script>
</head>
<body>
    
    <div class="form-container">
        <form action = "" method = "post">
            <h3>REGISTER HERE</h3>
            
            <label>Name : </label>
            <input type = "text" name = "name" required placeholder = "ENTER YOUR NAME"><br>
            
            <label>AGE : </label>
            <input type = "text" name = "age" required placeholder = "ENTER YOUR AGE"><br>
            
            <label>DATE OF BIRTH : </label>
            <input type = "date" name = "dob" required placeholder = "ENTER YOUR DATE-OF-BIRTH"><br>
            
            <label>GENDER : </label>
            <select name = "gender" required>
                <option value = "male">Male</option>
                <option value = "female">Female</option>
            </select><br>
            
            <label>EMAIL : </label>
            <input type = "email" name = "email" required placeholder = "ENTER YOUR email"><br>
            
            <label>CONTACT NUMBER : </label>
            <input type = "tel" name = "contact" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}" required placeholder = "ENTER YOUR PHONE NUMBER"><br>
            
            <label>BLOOD TYPE : </label>
            <select name = "blood_type" required>
                    <option value = "A+">A RhD positive (A+)</option>
                    <option value = "A-">A RhD negative (A-)</option>
                    <option value = "B+">B RhD positive (B+)</option>
                    <option value = "B-">B RhD negative (B-)</option>
                    <option value = "O+">O RhD positive (O+)</option>
                    <option value = "O-">O RhD negative (O-)</option>
                    <option value = "AB+">AB RhD positive (AB+)</option>
                    <option value = "AB-">AB RhD negative (AB-)</option>
            </select><br>

            <label>STATE : </label>
            <select id = "state" name = "state" size = "1">
                <option value = "" selected = "selected">--Select State--</option>
            </select><br>
            <label>DISTRICT : </label>
            <select id = "district" name = "district" size = "1">
                <option value = "" selected = "selected">--Select District--</option>
            </select><br>
    
            
            <label>SET PASSWORD : </label>
            <input type = "password" name = "password" required placeholder = "SET PASSWORD"><br>

            <input type = "button" name = "submit" VALUE = "SUBMIT"><br>

            <input type = "button" name = "clear" value = "CLEAR">
        </form>
        <h3>Already have an account <a href = "login.html">LOGIN HERE</a></h3>
        
    </div>
</body>
</html>