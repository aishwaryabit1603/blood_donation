<?php
    //start a session output buffering
    ob_start();
    session_start();

    //must require db connection file
    require "db_connection.php";

    //checking if all post fields are SET
    if(isset($_POST['name']) && isset($_POST['sex']) && isset($_POST['dob']) &&isset($_POST['bloodgroup']) &&isset($_POST['mobile_no']) &&isset($_POST['email']) &&isset($_POST['state']) && isset($_POST['district']) && isset($_POST['user_name']) &&isset($_POST['password']))
    {
        if (!empty($_POST['name']) && !empty($_POST['sex']) && !empty($_POST['dob']) && !empty($_POST['bloodgroup']) && !empty($_POST['mobile_no']) && !empty($_POST['email']) && !empty($_POST['state']) && !empty($_POST['district']) && !empty($_POST['user_name']) && !empty($_POST['password'])) 
        {
            // Store POST variables in local variables
            $user = $_POST['user_name'];
            $pw = md5($_POST['password']);
            $f_name = $_POST['name'];
            $birthday = $_POST['dob'];
            $sex = $_POST['sex'];
            $blood = $_POST['bloodgroup'];
            $mobile = $_POST['mobile_no'];
            $email = $_POST['email'];
            $state = $_POST['state'];
            $district = $_POST['district']
        }
    }

    //checking if session is active or NOT
    if (isset($_SESSION['sess_user_id']) && !empty($_SESSION['sess_user_id'])) 
    {
        // If a session is active
        $sess = $_SESSION['sess_user_id'];
        $SQL = "UPDATE donors SET user_name='" .$user . "',password='" . $pw . "',name='" . $f_name . "',dob='" . $birthday . "',sex='" . $sex . "',bloodgroup='" . $blood . "',mobile_no='" . $mobile . "',email='" . $email . "',state='" . $state . "',district='" . $district . "' WHERE id='" . $sess . "'";
    } 
    else 
    {
        $SQL = "INSERT INTO donors ("user_name", "password", "name", dob, "sex", "bloodgroup", mobile_no, "email","state","district") VALUES ('" . $user . "', '" . $pw . "', '" . $f_name . "', '" . $birthday . "', '" . $sex . "', '" . $blood . "', '" . $mobile . "', '" . $email . "', '" . $state . "', '" . $district . "')";
    }


?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REGISTRATION FORM</title>
    <LINK REL = "stylesheet" href = "css/register_form.css">
    <script type="text/javascript" src="statesdropdown.js.js"></script>
    
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
</head>
<body>
    
    <div class="form-container">
        <form action = "" method = "post" action="javascript:handleClick()">
            <h3>REGISTER HERE</h3>
            
            <label>Name : </label>
            <input type = "text" name = "name" required placeholder = "ENTER YOUR NAME"><br>
            
            <label>AGE : </label>
            <input type = "text" name = "age" required placeholder = "ENTER YOUR AGE"><br>
            
            <label>DATE OF BIRTH : </label>
            <input type = "date" name = "dob" required placeholder = "ENTER YOUR DATE-OF-BIRTH"><br>
            
            <label>GENDER : </label>
            <select name = "gender" required>
                <option value = "male">Male</option>
                <option value = "female">Female</option>
            </select><br>
            
            <label>EMAIL : </label>
            <input type = "email" name = "email" required placeholder = "ENTER YOUR email"><br>
            
            <label>CONTACT NUMBER : </label>
            <input type = "tel" name = "contact" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}" required placeholder = "ENTER YOUR PHONE NUMBER"><br>
            
            <label>BLOOD TYPE : </label>
            <select name = "blood_type" required>
                    <option value = "A+">A RhD positive (A+)</option>
                    <option value = "A-">A RhD negative (A-)</option>
                    <option value = "B+">B RhD positive (B+)</option>
                    <option value = "B-">B RhD negative (B-)</option>
                    <option value = "O+">O RhD positive (O+)</option>
                    <option value = "O-">O RhD negative (O-)</option>
                    <option value = "AB+">AB RhD positive (AB+)</option>
                    <option value = "AB-">AB RhD negative (AB-)</option>
            </select><br>

            <label for="inputState">State</label>
            <select class="form-control" id="inputState">
                        <option value="SelectState">Select State</option>
                        <option value="Andra Pradesh">Andra Pradesh</option>
                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                        <option value="Assam">Assam</option>
                        <option value="Bihar">Bihar</option>
                        <option value="Chhattisgarh">Chhattisgarh</option>
                        <option value="Goa">Goa</option>
                        <option value="Gujarat">Gujarat</option>
                        <option value="Haryana">Haryana</option>
                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                        <option value="Jharkhand">Jharkhand</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Kerala">Kerala</option>
                        <option value="Madya Pradesh">Madya Pradesh</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Manipur">Manipur</option>
                        <option value="Meghalaya">Meghalaya</option>
                        <option value="Mizoram">Mizoram</option>
                        <option value="Nagaland">Nagaland</option>
                        <option value="Orissa">Orissa</option>
                        <option value="Punjab">Punjab</option>
                        <option value="Rajasthan">Rajasthan</option>
                        <option value="Sikkim">Sikkim</option>
                        <option value="Tamil Nadu">Tamil Nadu</option>
                        <option value="Telangana">Telangana</option>
                        <option value="Tripura">Tripura</option>
                        <option value="Uttaranchal">Uttaranchal</option>
                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                        <option value="West Bengal">West Bengal</option>
                        <option disabled style="background-color:#aaa; color:#fff">UNION Territories</option>
                        <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                        <option value="Chandigarh">Chandigarh</option>
                        <option value="Dadar and Nagar Haveli">Dadar and Nagar Haveli</option>
                        <option value="Daman and Diu">Daman and Diu</option>
                        <option value="Delhi">Delhi</option>
                        <option value="Lakshadeep">Lakshadeep</option>
                        <option value="Pondicherry">Pondicherry</option>
            </select><br>
            <label for="inputDistrict">District</label>
            <select class="form-control" id="inputDistrict" >
                      <option value="">-- select one -- </option>
            </select>
    
            
            <br>
                      <label>SET PASSWORD : </label>
            <input type = "password" name = "password" required placeholder = "SET PASSWORD"><br>

            <input type = "button" name = "submit" VALUE = "SUBMIT"><br>

            <input type = "button" name = "clear" value = "CLEAR">
        </form>
        <h3>Already have an account <a href = "login.html">LOGIN HERE</a></h3>
        
    </div>
</body>
</html>